<html>
<head>
    <script async src="../../build/dev/prebid.js"></script>
    <script async src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var FAILSAFE_TIMEOUT = 3300;
        var PREBID_TIMEOUT = 1000;

        var adUnits = [{
            code: 'div-gpt-ad-1460505748561-0',
            mediaTypes: {
                banner: {
                    sizes: [[300, 250]],
                }
            },
            bids: [{
                bidder: 'bms',
                params: {
                    bidFloor: 0.05,
                    currency: 'USD',
                    placementId: 13144370,
                    publisherId: 13144370
                }
            }]
        }];

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        // Adiciona informações de geolocalização manualmente para teste
        var ortb2 = {
            device: {
                geo: {
                    lat: -23.5505,  // Exemplo: coordenada de São Paulo
                    lon: -46.6333,
                    type: 1,        // GPS/Location Services
                    accuracy: 100   // Precisão em metros
                }
            }
        };
    </script>

    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
        googletag.cmd.push(function () {
            googletag.pubads().disableInitialLoad();
        });

        pbjs.que.push(function () {
            // Configura informações de geolocalização para o Prebid
            pbjs.setConfig({
                ortb2: ortb2
            });

            pbjs.addAdUnits(adUnits);

            pbjs.requestBids({
                bidsBackHandler: sendAdserverRequest,
                timeout: PREBID_TIMEOUT,
                ortb2: ortb2  // Adiciona geolocalização na requisição
            });
        });

        function sendAdserverRequest() {
            if (pbjs.adserverRequestSent) return;
            pbjs.adserverRequestSent = true;
            googletag.cmd.push(function () {
                pbjs.que.push(function () {
                    pbjs.setTargetingForGPTAsync();
                    googletag.pubads().refresh();
                });
            });
        }

        setTimeout(function () {
            sendAdserverRequest();
        }, FAILSAFE_TIMEOUT);

        // Função para depuração de geolocalização
        function logGeolocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    console.log('Geolocalização do navegador:');
                    console.log('Latitude: ' + position.coords.latitude);
                    console.log('Longitude: ' + position.coords.longitude);
                    console.log('Precisão: ' + position.coords.accuracy + ' metros');
                }, function(error) {
                    console.error('Erro na geolocalização:', error.message);
                });
            } else {
                console.warn('Geolocalização não suportada');
            }
        }

        // Chama a função de log de geolocalização quando a página carregar
        window.onload = logGeolocation;
    </script>

    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1460505748561-0').addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
</head>

<body>
    <h2>Prebid.js Test - Geolocation</h2>
    <h5>Div-1</h5>
    <div id='div-gpt-ad-1460505748561-0'>
        <script type='text/javascript'>
            googletag.cmd.push(function () { googletag.display('div-gpt-ad-1460505748561-0'); });
        </script>
    </div>

    <div id="geolocation-info">
        <h3>Geolocation Debug Information</h3>
        <p>Check browser console for geolocation details</p>
    </div>
</body>
</html>
